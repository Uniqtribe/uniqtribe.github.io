let patternSelection,productVariantId,selectedSwatch,isDragging=!1,selection=[],swatches=[],minPaletteCount=0,recommendedPaletteCount=0,maxPaletteCount=0,varientContainer=document.querySelector(".theme-product-detail-varients-container");function updateTargetValue(e){if(target.value){let t=JSON.parse(target.value);t.quantity=e,target.value=JSON.stringify(t)}}function updateFields(){loadBasicField();let e=0;selectionValue=[];for(let t=0;t<cartData.line_items.length;t++)if(cartData.line_items[t].item_id===productVariantId)for(let a=0;a<cartData.line_items[t].item_custom_fields.length;a++)(cartData.line_items[t].item_custom_fields[a].label.startsWith("target")||cartData.line_items[t].item_custom_fields[a].label.startsWith("selection"))&&""!=cartData.line_items[t].item_custom_fields[a].value_formatted&&(selectionValue[e]=JSON.parse(cartData.line_items[t].item_custom_fields[a].value_formatted),e++);loadSelectionFieldsWithPattern(),document.querySelector("#swatches-0").click(),document.querySelector("#customSelect").querySelectorAll("div[data-value]")[0].click()}function loadBasicField(){let e={};e.selected=basicColor[0].baseColor.map(rgbArrayToHexFromPattern),e.quantity=1,e.shape="",target.value=JSON.stringify(e);let t={};t.source=basicColor[0].baseColor.map(rgbArrayToHexFromPattern),source.value=JSON.stringify(t)}function rgbArrayToHexFromPattern(e){return`#${(1<<24|e.r<<16|e.g<<8|e.b).toString(16).slice(1).toUpperCase()}`}function loadSelectionFieldsWithPattern(){patternSelection=[];for(let e=0;e<selection.length;e++)selection[e].value="";console.log("Selection Value",selectionValue);for(let e=0;e<selectionValue.length;e++){for(let t=0;t<selection.length;t++){if(""===selection[t].value){selection[t].value=JSON.stringify(selectionValue[e]),t===selection.length-1&&(document.querySelector(".theme-cart-button").style.display="none");break}if(JSON.stringify(JSON.parse(selection[t].value).selected)===JSON.stringify(selectionValue[e].selected)&&JSON.stringify(JSON.parse(selection[t].value).shape)===JSON.stringify(selectionValue[e].shape)){let a=JSON.parse(selection[t].value);a.quantity=parseInt(a.quantity,10)+parseInt(selectionValue[e].quantity,10),selection[t].value=JSON.stringify(a),cartPatternContainer.append(JSON.stringify(a));break}}let t=0;variantRows.forEach((e=>{let a=e.querySelector(".theme-product-variant-label.theme-custom-field-label");if(a?.textContent.replace("*","").trim().toLowerCase().startsWith("selection")){if(""!=e.querySelector("input").value){let a={};a.value=e.querySelector("input").value,a.field=e.querySelector("input").getAttribute("data-custom-field-id"),patternSelection[t]=JSON.stringify(a)}t++}}))}console.log("patternSelection",patternSelection),printPattern(patternSelection)}function parseColor(e){return{r:parseInt(e.substr(1,2),16),g:parseInt(e.substr(3,2),16),b:parseInt(e.substr(5,2),16)}}function rgbArrayToHex({r:e,g:t,b:a}){const o=e=>e.toString(16).padStart(2,"0");return`#${o(e)}${o(t)}${o(a)}`}function printPattern(e){const t=document.querySelector(".theme-product-variant-pattern");0==e.length?t.innerHTML="No Items in Cart":t.innerHTML="",e.forEach((e=>{const a=createColumnDiv(e);t.appendChild(a)})),attachQuantityEventListeners()}function attachQuantityEventListeners(){const e=document.querySelector("#cartContainer"),t=e.querySelectorAll(".theme-quantity-decrease"),a=e.querySelectorAll(".theme-quantity-increase"),o=e.querySelectorAll(".remove-button");t.forEach((e=>{e.addEventListener("click",(function(){const e=this.nextElementSibling;e.value=parseInt(e.value)-1;let t=e.getAttribute("customField"),a=JSON.parse(document.querySelector(`[data-custom-field-id="${t}"]`).value);a.quantity=e.value,target.value=JSON.stringify(a),setCustomSelectValue(a.shape),document.querySelector(`[data-custom-field-id="${t}"]`).value="",addToCart(-1)}))})),a.forEach((e=>{e.addEventListener("click",(function(){const e=this.previousElementSibling;e.value=parseInt(e.value)+1;let t=e.getAttribute("customField"),a=JSON.parse(document.querySelector(`[data-custom-field-id="${t}"]`).value);a.quantity=e.value,target.value=JSON.stringify(a),setCustomSelectValue(a.shape),document.querySelector(`[data-custom-field-id="${t}"]`).value="",addToCart(1)}))})),o.forEach((e=>{e.addEventListener("click",(function(){const e=event.target.closest(".theme-product-quantity-spinner").querySelector("input[customfield]");let t=e.getAttribute("customField");document.querySelector(`[data-custom-field-id="${t}"]`).value="",target.value="",addToCart(-1*parseInt(e.value))}))}))}function extractIdFromUrl(e){try{const t=new URL(e).pathname.split("/");return t[t.length-1]}catch(e){return console.error("Invalid URL:",e),null}}function addLightboxEventListener(){document.querySelectorAll(".no-lightbox").forEach((e=>{const t=e.querySelector("img");t&&t.addEventListener("click",(function(e){if(this.closest(".no-lightbox"))return e.stopPropagation(),void e.preventDefault()}))}))}function createColumnDiv(e){const t=document.createElement("div");t.classList.add("row");const a=document.createElement("div");a.classList.add("column"),a.classList.add("canvas-column");const o=createCanvas(e);a.appendChild(o);const n=document.createElement("div");n.classList.add("column"),n.classList.add("shape-column"),n.classList.add("column"),n.classList.add("wideColumn"),n.innerHTML="Shape :<br><br>"+JSON.parse(JSON.parse(e).value).shape;const r=document.createElement("div");r.classList.add("column"),r.classList.add("shape-column"),r.classList.add("narrowColumn"),r.innerHTML="Shape : "+JSON.parse(JSON.parse(e).value).shape;const l=document.createElement("div");l.classList.add("column"),l.classList.add("quantity-column");const s=createQuantitySpinner(e);return l.appendChild(s),t.appendChild(a),t.appendChild(n),t.appendChild(r),t.appendChild(l),t}function createCanvas(e){const t=document.createElement("canvas"),a=t.getContext("2d");t.width=150,t.height=150,a.imageSmoothingEnabled=!0,a.imageSmoothingQuality="high";const o=new Image;return o.src=document.querySelector('img[alt*="base-image"]').src,o.onload=function(){a.drawImage(o,0,0,t.width,t.height),processImageData(a,e)},t}function processImageData(e,t){const a=e.getImageData(0,0,e.canvas.width,e.canvas.height),o=a.data,n=basicColor[0].baseColor,r=convertHexArrayToRgbArray(JSON.parse(JSON.parse(t).value).selected);for(let e=0;e<o.length;e+=4){const[t,a,l]=[o[e],o[e+1],o[e+2]],s=findClosestColorIndex(t,a,l,n);if(-1!==s){const c=applyDirectionToColor(r[s],{r:t-n[s].r,g:a-n[s].g,b:l-n[s].b});o[e]=c.r,o[e+1]=c.g,o[e+2]=c.b}}e.putImageData(a,0,0)}function createQuantitySpinner(e){const t=document.createElement("div");t.className="theme-product-quantity-spinner";const a=createButton("theme-quantity-decrease",""),o=createButton("theme-quantity-increase",""),n=(createRemoveButton(),document.createElement("input"));return n.value=JSON.parse(JSON.parse(e).value).quantity,n.setAttribute("customField",JSON.parse(e).field),n.disabled=!0,n.style.border="none",n.style.textAlign="center",t.append(a,n,o),t}function createButton(e,t){const a=document.createElement("input");return a.className=e,a.type="button",a.value=t,a}function createRemoveButton(){const e=document.createElement("button");return e.className="remove-button",e.textContent="X",e}function convertHexArrayToRgbArray(e){return e.map((e=>hexToRgb(e)))}function hexToRgb(e){e=e.replace(/^#/,"");const t=parseInt(e,16);return{r:t>>16&255,g:t>>8&255,b:255&t}}function findClosestColorIndex(e,t,a,o){let n=-1,r=1/0;return o.forEach(((o,l)=>{const s=Math.abs(e-o.r)+Math.abs(t-o.g)+Math.abs(a-o.b);s<r&&(r=s,n=l)})),n}function applyDirectionToColor(e,t){const a={r:e.r+t.r,g:e.g+t.g,b:e.b+t.b};return{r:Math.min(255,Math.max(0,Math.round(a.r))),g:Math.min(255,Math.max(0,Math.round(a.g))),b:Math.min(255,Math.max(0,Math.round(a.b)))}}async function populatePalette(){const e=await fetchColors(),t=document.createDocumentFragment(),a=document.createDocumentFragment();basicColor[0].baseColor.forEach(((e,a)=>{const o=document.createElement("div"),n=document.createElement("div");n.style.backgroundColor=`rgb(${e.r}, ${e.g}, ${e.b})`,n.style.width="25px",n.style.height="25px",n.className=0===a?"custom-selected-color selected":"custom-selected-color",o.appendChild(n),t.appendChild(o),n.addEventListener("click",(()=>{document.querySelector(".custom-selected-color.selected")?.classList.remove("selected"),n.classList.add("selected"),updateSwatches(n.style.backgroundColor)}))})),sectionSelector.appendChild(t),e.forEach((e=>{const t=document.createElement("div");t.className="color-swatch",t.style.backgroundColor=e.hex,t.dataset.colorName=e.name;const o=document.createElement("div");o.className="color-name",o.textContent=e.name,t.appendChild(o),t.addEventListener("click",(()=>handleColorClick(t))),a.appendChild(t)}));const o=createColorPickerSwatch();a.appendChild(o),paletteContainer.appendChild(a)}function generateControls(){const e=basicColor[0].baseColor,t=basicColor[0].alternativeColor;colorControlsContainer.innerHTML="",toColorSwatchesContainer.innerHTML="";const a=document.createElement("div");if(a.className="colorSwatches selected",a.id="swatches-0",a.style.backgroundImage=generateVerticalGradientPalette(e),toColorSwatchesContainer.appendChild(a),!0===configObject.customColor){t.forEach(((t,a)=>{const o=document.createElement("div");o.className="colorSwatches",o.id=`swatches-${a+1}`,o.style.backgroundImage=generateVerticalGradientPalette(e),toColorSwatchesContainer.appendChild(o),swatches.push(o)}));const a=document.createElement("div");a.className="colorSwatches custom-color-selector",a.id=`swatches-${t.length+1}`,a.style.backgroundImage=generateVerticalGradientPalette(e),a.style.border="0.5px solid black",a.style.position="relative";const o=document.createElement("img");o.src="https://uniqtribe.github.io/Custom-Palette.png",o.alt="Overlay Image",o.className="overlay-image",a.appendChild(o),toColorSwatchesContainer.appendChild(a),t.forEach(((e,t)=>{populateSwatchesForIndex(t,e)})),addClickEventToSwatches()}}function generateVerticalGradient(e,t=!1){console.log("24");const a=100/e.length,o=e.map(((e,t)=>`${e} ${t*a}% ${(t+1)*a}%`)).join(", ");return console.log("25",o),`linear-gradient(to right, ${o})`}async function fetchColors(){try{const e=await fetch("https://uniqtribe.github.io/colors.json");if(!e.ok)throw new Error("Network response was not ok");return await e.json()}catch(e){return console.error("Failed to fetch colors:",e),[]}}function createColorPickerSwatch(){const e=document.createElement("div");e.className="color-swatch custom-colors";const t=document.createElement("div");return t.className="color-name",t.textContent="custom",e.appendChild(t),e.addEventListener("click",(()=>{handleColorClick(e),openColorPicker()})),e}function populateSwatchesForIndex(e,t){const a=swatches[e];a.innerHTML="",a.style.backgroundImage=generateVerticalGradientPalette(t)}function addClickEventToSwatches(){swatchElements=document.querySelectorAll(".colorSwatches"),swatchElements.forEach((e=>{e.addEventListener("click",(function(){this.classList.contains("custom-color-selector")&&!0===configObject.customColor?customColorPicker.style.display="block":customColorPicker.style.display="none",swatchElements.forEach((e=>e.classList.remove("selected"))),this.classList.add("selected"),changeColor([...new Set(this.style.backgroundImage.match(/rgb\((\d+, \d+, \d+)\)/g))])}))}))}function generateCustomSelect(){const e=document.querySelector('select[data-label="Shape"]');if(document.querySelector("#customSelectContainer")&&document.querySelector("#customSelectContainer").remove(),e){const t=document.createElement("div");t.id="customSelectContainer",e.parentNode.insertBefore(t,e.nextSibling);let a="";Array.from(e.options).forEach(((e,t)=>{0===t&&"Choose an option"===e.textContent.trim()||(configObject.shapes.includes(e.value)||configObject.shapes.includes(e.value.toLowerCase()))&&(a+=`\n                    <div data-value="${e.value}">\n                        ${e.textContent}\n                    </div>\n                `)})),t.innerHTML='<div class="custom-select" id="customSelect">'+a+"</div>";t.querySelectorAll("div[data-value]").forEach((e=>{e.addEventListener("click",(function(){selectOption(this)}))}))}else console.error('No select element found with data-label="Shape".')}function createColorPicker(){rgbColorPicker=document.getElementById("rgbColorPicker"),rgbColorPickerCtx=rgbColorPicker.getContext("2d",{willReadFrequently:!0});const e=rgbColorPickerCtx.createLinearGradient(0,0,rgbColorPicker.width,0);e.addColorStop(0,"red"),e.addColorStop(.16,"orange"),e.addColorStop(.33,"yellow"),e.addColorStop(.5,"green"),e.addColorStop(.66,"cyan"),e.addColorStop(.83,"blue"),e.addColorStop(1,"magenta"),rgbColorPickerCtx.fillStyle=e,rgbColorPickerCtx.fillRect(0,0,rgbColorPicker.width,rgbColorPicker.height);const t=rgbColorPickerCtx.createLinearGradient(0,0,0,rgbColorPicker.height);t.addColorStop(0,"rgba(255, 255, 255, 1)"),t.addColorStop(.5,"rgba(255, 255, 255, 0)"),t.addColorStop(.5,"rgba(0, 0, 0, 0)"),t.addColorStop(1,"rgba(0, 0, 0, 1)"),rgbColorPickerCtx.fillStyle=t,rgbColorPickerCtx.fillRect(0,0,rgbColorPicker.width,rgbColorPicker.height),rgbColorPicker.addEventListener("mousedown",startDragging),rgbColorPicker.addEventListener("mousemove",duringDragging),rgbColorPicker.addEventListener("mouseup",stopDragging),rgbColorPicker.addEventListener("touchstart",startDragging,{passive:!0}),rgbColorPicker.addEventListener("touchmove",duringDragging,{passive:!0}),rgbColorPicker.addEventListener("touchend",stopDragging,{passive:!0})}function startDragging(e){isDragging=!0,updateSelection(e)}function duringDragging(e){isDragging&&updateSelection(e)}function stopDragging(){isDragging=!1}function selectOption(e){const t=document.getElementById("customSelect"),a=document.querySelector('select[data-label="Shape"]');Array.from(t.children).forEach((e=>e.classList.remove("selected")));let o=JSON.parse(target.value);o.shape=e.getAttribute("data-value"),target.value=JSON.stringify(o),e.classList.add("selected"),a.value=e.getAttribute("data-value"),a.dispatchEvent(new Event("change"))}function setCustomSelectValue(e){const t=document.getElementById("customSelect"),a=document.querySelector('select[data-label="Shape"]'),o=Array.from(t.children).find((t=>t.getAttribute("data-value")===e));o?(Array.from(t.children).forEach((e=>e.classList.remove("selected"))),o.classList.add("selected"),a.value=e):console.error("Desired value not found in custom select options.")}function addToCart(e){let t=[],a=e;variantRows.forEach((e=>{let a=e.querySelector(".theme-product-variant-label.theme-custom-field-label");if("Shape"===a?.textContent.replace("*","").trim()){let a={};shape=e.querySelector("select"),a.customfield_id=shape.getAttribute("data-custom-field-id"),a.label="Shape",a.data_type="string",a.value=shape.value,t.push(a)}if("source"===a?.textContent.replace("*","").trim()){source=e.querySelector("input");let a={};source=e.querySelector("input"),a.customfield_id=target.getAttribute("data-custom-field-id"),a.label="source",a.data_type="string",a.value=source.value,t.push(a)}if("target"===a?.textContent.replace("*","").trim()){let a={};target=e.querySelector("input"),a.customfield_id=target.getAttribute("data-custom-field-id"),a.label="target",a.data_type="string",a.value=target.value,t.push(a)}if(a?.textContent.replace("*","").trim().toLowerCase().startsWith("selection")){let o={},n=e.querySelector("input");o.customfield_id=n.getAttribute("data-custom-field-id"),o.label=a?.textContent.replace("*","").trim().toLowerCase(),o.data_type="string",o.value=n.value,""!=n.value&&t.push(o)}})),console.log("custom_field_list ",t);const o={product_variant_id:productVariantId,quantity:a,custom_fields:t},n={url:"/storefront/api/v1/cart",method:"POST",headers:{"Content-Type":"application/json",...zsUtils.getCSRFHeader()},body:JSON.stringify(o)};fetch(n.url,{method:n.method,headers:n.headers,body:n.body}).then((e=>e.json())).then((e=>{const t=e.payload?.items||e.cart_details?.items;if(t){updateCartUI(t.length),updateCartSuccess({cart:e,productId:productVariantId,view:window.zs_view||"store_page"})}else e.error&&e.error.code===CONST.BOOKS_API_RESPONSE.STOREFRONT_CUSTOM_FIELD_ERROR?dispatchFailureEvent(e,o.productId):handleErrorResponse(e)})).catch((e=>{console.error("Network error:",e),dispatchFailureEvent({message:e.message},o.productId)}))}function updateCartUI(e){console.log(`Cart updated with ${e} items`)}function dispatchFailureEvent(e,t){const a=new CustomEvent("zp-event-add-to-cart-failure",{detail:{response:e,productId:t,view:window.zs_view||"store_page"}});document.dispatchEvent(a)}function updateCartSuccess(e){var t=document.querySelectorAll('[data-cart-add-success="theme-cart-add-success"]')[0],a=document.querySelectorAll("[data-theme-message-four]")[0],o=document.getElementById("product_quick_look");addClass(t,"theme-cart-success"),removeClass(t,"theme-cart-success-remove"),a&&(addClass(t,"theme-cart-added-success"),removeClass(t,"theme-cart-added-success-remove")),o&&a&&closeProductQuickLook();var n=document.querySelectorAll('[data-cart-add-success-prod-name="theme-cart-add-success-prod-name"]')[0],r=document.querySelectorAll('[data-cart-add-success-prod-img="theme-cart-add-success-prod-img"]')[0],l=document.querySelectorAll('[ data-cart-add-success-count="theme-cart-add-success-prod-count"]')[0],s=document.querySelectorAll("[data-thumbnail]"),c=document.querySelectorAll('[data-theme-thumbnail-container="theme-thumbnail-container-'+e.productId+'"]')[0],i=(document.querySelectorAll('[data-detail-image="theme-detail-image"]')[0],document.querySelectorAll('[data-thumbnail-prod-id="'+e.productId+'"]')[0]);if(i)var d=i.querySelectorAll("[data-thumbnail-active]");if(i)for(iurl=0;iurl<d.length;iurl++){d[iurl].getAttribute("data-thumbnail-active");0==iurl&&d[iurl].click()}for(ti=0;ti<s.length;ti++)s[ti]&&(s[ti].style.display="flex");c&&(c.style.display="flex"),c&&activeThumbnail();e.detail;var u,h=e.productId,m=e.cart.payload.items;for(var g of m)if(g.variant_id==h){u=g;break}if(n&&(n.innerHTML=u.name),l&&(l.innerHTML=m.length),u.images){var p=u.images[0].url,v=u.images[0].alternate_text,b=u.images[0].title;u.images[0].is_placeholder_image||(p+="/5"),r&&(r.setAttribute("src",p),r.setAttribute("alt",v),r.setAttribute("title",b))}}function changeColor(e){let t={};t.selected=e.map((e=>rgbToHex(e))),t.quantity=quantityInput.value,target.value=JSON.stringify(t);let a,o=document.querySelector('img[alt*="base-image"]');o.complete?(designCanvasCtx.clearRect(0,0,800,800),designCanvasCtx.drawImage(o,0,0,800,800)):o.onload=()=>{designCanvasCtx.clearRect(0,0,800,800),designCanvasCtx.drawImage(o,0,0,800,800)},a=designCanvasCtx.getImageData(0,0,800,800),data=a.data;const n=basicColor[0].baseColor,r=basicColor[0].baseColor.map((({r:e,g:t,b:a})=>`#${(1<<24|e<<16|t<<8|a).toString(16).slice(1).toUpperCase()}`)),l=(n.map((e=>({r:Math.abs(255-e.r),g:Math.abs(255-e.g),b:Math.abs(255-e.b)}))),data.length);for(let t=0;t<l;t+=4){const a=data[t],o=data[t+1],l=data[t+2];let s=-1,c=1/0;for(let e=0;e<n.length;e++){const t=Math.abs(a-n[e].r)+Math.abs(o-n[e].g)+Math.abs(l-n[e].b);t<c&&(c=t,s=e)}if(-1!==s){r[s];const c=applyDirectionToColor(rgbStringToObject(e[s]),{r:a-n[s].r,g:o-n[s].g,b:l-n[s].b});data[t]=c.r,data[t+1]=c.g,data[t+2]=c.b}}designCanvasCtx.putImageData(a,0,0);textureLoader.load(document.querySelector("#designCanvas").toDataURL("image/png"),(function(e){e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,e.repeat.set(1,1),object.traverse((function(t){if(t.isMesh){t.name===configObject.imageInfo.backgroundPattern?t.material=new THREE.MeshStandardMaterial({map:e,transparent:!0,opacity:1,depthWrite:!1,emissive:new THREE.Color(16777215),emissiveIntensity:.3,color:new THREE.Color(16777215)}):configObject.imageInfo.appliedPattern.includes(t.name)&&(t.material=new THREE.MeshStandardMaterial({map:e,transparent:!0,opacity:1,depthWrite:!1}));const a=textures.find((e=>e.objects.includes(t.name)));a&&(t.material=new THREE.MeshStandardMaterial({map:a.texture,transparent:a.transparent})),t.material.needsUpdate=!0}}))}));const s=document.querySelector("#customSelect div[data-value].selected");s&&s.click()}function rgbToHex(e){return"#"+e.match(/\d+/g).map((e=>{const t=parseInt(e).toString(16);return 1===t.length?"0"+t:t})).join("")}function rgbStringToObject(e){const t=e.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);if(t){return{r:parseInt(t[1],10),g:parseInt(t[2],10),b:parseInt(t[3],10)}}throw new Error("Invalid RGB string format")}function handleColorClick(e){document.querySelectorAll(".color-swatch").forEach((e=>{e.classList.remove("active");const t=e.querySelector(".color-name");t&&(t.style.display="none")})),e.classList.add("active"),document.getElementById("color-display").textContent=`Selected Color: ${e.dataset.colorName}`,e.querySelector(".color-name").style.display="block";const t=e.style.backgroundColor,a=document.querySelector(".sectionSelector .custom-selected-color.selected");a&&(a.style.backgroundColor=t),updateCustomColor(),selectedSwatch=e}function updateCustomColor(){const e=document.querySelectorAll(".custom-selected-color"),t=[];e.forEach((e=>{t.push(e.style.backgroundColor)})),document.querySelector(".custom-color-selector").style.backgroundImage=generateVerticalGradient(t.map((e=>e))),changeColor([...new Set(document.querySelector(".custom-color-selector").style.backgroundImage.match(/rgb\((\d+, \d+, \d+)\)/g))])}function updateSelection(e){const t=rgbColorPicker.getBoundingClientRect(),a=rgbColorPicker.width/t.width,o=rgbColorPicker.height/t.height;pickColor((e.clientX-t.left)*a,(e.clientY-t.top)*o)}function pickColor(e,t){(e=Math.round(e))<0&&(e=0),(t=Math.round(t))<0&&(t=0),e>=rgbColorPicker.width&&(e=rgbColorPicker.width-1),t>=rgbColorPicker.height&&(t=rgbColorPicker.height-1),createColorPicker();const a=rgbColorPickerCtx.getImageData(e,t,1,1).data,o=`rgb(${a[0]}, ${a[1]}, ${a[2]})`;selectedColorDiv.style.backgroundColor=o,rgbColorPickerCtx.beginPath(),rgbColorPickerCtx.arc(e,t,5,0,2*Math.PI),rgbColorPickerCtx.strokeStyle="#000",rgbColorPickerCtx.lineWidth=2,rgbColorPickerCtx.stroke(),rgbColorPickerCtx.closePath(),currentX=e,currentY=t;const n=document.querySelector(".sectionSelector .custom-selected-color.selected");n&&(n.style.backgroundColor=o),document.querySelectorAll(".color-swatch").forEach((e=>{o===e.style.backgroundColor?(e.className="color-swatch active",e.querySelector(".color-name").style.display="block"):(e.className="color-swatch",e.querySelector(".color-name").style.display="none")})),updateCustomColor()}function updateSwatches(e){document.querySelectorAll(".color-swatch").forEach((t=>{const a=e===t.style.backgroundColor;t.className=a?"color-swatch active":"color-swatch",t.querySelector(".color-name").style.display=a?"block":"none"}))}function getColorDistance(e,t){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)+Math.pow(t[2]-e[2],2))}function calculateColorFrequency(e,t){const a=document.getElementById("imageCanvas"),o=a.getContext("2d");o.willReadFrequently=!0,a.width=e.width,a.height=e.height,o.putImageData(e,0,0);const n=o.getImageData(0,0,a.width,a.height).data;let r=new Array(t.length).fill(0);for(let e=0;e<n.length;e+=4){const a=[n[e],n[e+1],n[e+2]];let o=-1,l=1/0;for(let e=0;e<t.length;e++){const n=t[e],r=getColorDistance(a,n);r<l&&(l=r,o=e)}r[o]++}const l=n.length/4;return t.map(((e,t)=>({color:e,frequency:(r[t]/l*100).toFixed(2)})))}function calculateClusterVariance(e){const t=e.reduce(((e,t)=>(e[0]+=t[0],e[1]+=t[1],e[2]+=t[2],e)),[0,0,0]).map((t=>t/e.length)),a=[0,0,0];e.forEach((e=>{for(let o=0;o<3;o++)a[o]+=Math.pow(e[o]-t[o],2)}));const o=a.map((t=>t/e.length));return Math.sqrt(o.reduce(((e,t)=>e+t),0))}function simpleClusterColors(e){let t=[];for(let a=0;a<e.length;a++){let o=e[a],n=!1;for(let e of t){const t=e[0];if(getColorDistance(o,t)<100){e.push(o),n=!0;break}}n||t.push([o])}return{averagedColors:t.map((e=>e.reduce(((e,t)=>(e[0]+=t[0],e[1]+=t[1],e[2]+=t[2],e)),[0,0,0]).map((t=>Math.round(t/e.length))))),clusterVariances:t.map((e=>calculateClusterVariance(e)))}}function getColorDistance(e,t){const a=e[0]-t[0],o=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(a*a+o*o+n*n)}function calculateClusterVariance(e){const t=e.reduce(((e,t)=>(e[0]+=t[0],e[1]+=t[1],e[2]+=t[2],e)),[0,0,0]).map((t=>t/e.length)),a=[0,0,0];e.forEach((e=>{for(let o=0;o<3;o++)a[o]+=Math.pow(e[o]-t[o],2)}));const o=a.map((t=>t/e.length));return Math.sqrt(o.reduce(((e,t)=>e+t),0))}function generateVerticalGradientPalette(e,t=!1){const a=100/e.length,o=e.map(((e,t)=>{const o=t*a,n=(t+1)*a;return`rgb(${e.r},${e.g},${e.b}) ${o}% ${n}%`})).join(", ");return`linear-gradient(to right, ${o})`}function generatePalettes(e){const t={Analogous:[],Complementary:[],Triadic:[],SplitComplementary:[],Monochromatic:[],Tetradic:[],Square:[],SplitTriadic:[],Accent:[],ShadesGradients:[],Warm:[],Cool:[],Pastel:[],Earthy:[],Neon:[],HighContrast:[],Muted:[],Vibrant:[],Gradient:[],Tonal:[],Polychromatic:[],Retro:[],Spring:[],Summer:[],Autumn:[],Winter:[],Corporate:[],Sporty:[],Minimalist:[],Luxury:[],Candy:[],Floral:[],Oceanic:[],Metallic:[],Tropical:[],Sunset:[],Galaxy:[],Forest:[],Rainbow:[],SciFi:[],Vintage:[],DarkMode:[],HighSaturation:[],LowSaturation:[],Ethnic:[],Industrial:[],NatureInspired:[],Solar:[],Aurora:[],Citrus:[],SandAndSea:[],Desert:[],Ice:[],Fire:[],JewelTone:[],VintageCinema:[],Futuristic:[],AutumnLeaves:[],WinterWonderland:[],SpringBlossom:[],SummerSky:[],Underwater:[],Coffee:[],Rustic:[],Festival:[],Royal:[],Cyberpunk:[],NaturesHarvest:[],Urban:[],GalaxyNight:[],FloralPastel:[],OceanSunset:[],Greyscale:[],RainbowPastel:[],MutedEarth:[],ForestTwilight:[],Polar:[],Peacock:[],PixelArt:[],GradientSpectrum:[],FlatUI:[],SciFiNeon:[],MetalAndStone:[],Weather:[],ComicBook:[],MinimalistNeutral:[],CandyCoated:[],Gothic:[],Garden:[],FrostedGlass:[],Painterly:[],ShadowAndLight:[],NightSky:[],CoralReef:[],Marble:[],Smoke:[],StainedGlass:[],MinimalEarth:[]};e.length;return e.forEach((([a,o,n],r)=>{const[l,s,c]=rgbToHsv(a,o,n),i=30*(r%2==0?1:-1);t.Analogous.push(hsvToRgb((l+i)%360,s,c)),t.Complementary.push(hsvToRgb((l+180)%360,s,c));const d=120*(r%3-1);t.Triadic.push(hsvToRgb((l+d+360)%360,s,c));const u=150*(r%2==0?1:-1);t.SplitComplementary.push(hsvToRgb((l+u)%360,s,c)),t.Monochromatic.push(hsvToRgb(l,s,Math.min(c+.1*(r+1),1)));t.Tetradic.push(hsvToRgb((l+[0,180,90,-90][r%4]+360)%360,s,c)),t.Square.push(hsvToRgb((l+90*r%360)%360,s,c)),t.SplitTriadic.push(hsvToRgb((l+u)%360,s,c));const h=180-(r%2==0?30:-30);t.Accent.push(hsvToRgb((l+h)%360,s,c)),t.ShadesGradients.push(hsvToRgb(l,s,c*(1-.2*r))),t.Warm.push(hsvToRgb((l+30)%360,s,c)),t.Cool.push(hsvToRgb((l+180)%360,s,c)),t.Pastel.push(hsvToRgb(l,.3,Math.min(c+.2*(r+1),1))),t.Earthy.push(hsvToRgb(l,.5*s,.7*c)),t.Neon.push(hsvToRgb(l,1,1)),t.HighContrast.push(hsvToRgb((l+180)%360,s,Math.max(c-.2,0))),t.Muted.push(hsvToRgb(l,.5*s,.8*c)),t.Vibrant.push(hsvToRgb(l,1,Math.min(c+.3,1))),t.Gradient.push(hsvToRgb(l,s,Math.min(c+.3,1))),t.Tonal.push(hsvToRgb(l,s,Math.min(c+.2,1)));const m=45*(r%2==0?1:-1);t.Polychromatic.push(hsvToRgb((l+m)%360,s,c)),t.Retro.push(hsvToRgb(l,.6*s,Math.min(c+.1,1))),t.Spring.push(hsvToRgb(l,.3*s,Math.min(c+.4,1))),t.Summer.push(hsvToRgb(l,s,Math.min(c+.2,1))),t.Autumn.push(hsvToRgb(l,.7*s,.8*c)),t.Winter.push(hsvToRgb(l,.5*s,Math.min(c-.1,1))),t.Corporate.push(hsvToRgb(l,.5*s,.6*c)),t.Sporty.push(hsvToRgb(l,s,Math.min(c+.5,1))),t.Minimalist.push(hsvToRgb(l,.2*s,Math.min(c+.1,1))),t.Luxury.push(hsvToRgb(l,s,Math.min(c+.4,1))),t.Candy.push(hsvToRgb(l,1,Math.min(c+.6,1))),t.Floral.push(hsvToRgb(l,.3*s,Math.min(c+.2,1))),t.Oceanic.push(hsvToRgb((l+120)%360,s,Math.min(c+.3,1)));t.Metallic.push(hsvToRgb([45,0,30][r%3],.8*s,.9*c)),t.Tropical.push(hsvToRgb(l,1,Math.min(c+.3,1)));const g=r%3*60;t.Sunset.push(hsvToRgb((l+g)%360,Math.min(s+.2,1),c));t.Galaxy.push(hsvToRgb([270,240,300][r%3],s,Math.min(c-.2+r%2*.4,1)));t.Forest.push(hsvToRgb([120,30][r%2],.7*s,.8*c));const p=360/e.length*r;t.Rainbow.push(hsvToRgb(p,1,1)),t.SciFi.push(hsvToRgb(l,1,Math.min(c+.5,1))),t.Vintage.push(hsvToRgb(l,.5*s,.7*c)),r%4==0?t.DarkMode.push(hsvToRgb(l,s,Math.min(c+.5,1))):t.DarkMode.push(hsvToRgb(l,.2*s,.4*c)),t.HighSaturation.push(hsvToRgb(l,1,c)),t.LowSaturation.push(hsvToRgb(l,.2*s,.8*c));t.Ethnic.push(hsvToRgb([0,60,120,240][r%4],s,c)),t.Industrial.push(hsvToRgb(l,.1*s,c*(.5+r%2*.3)));t.NatureInspired.push(hsvToRgb([120,210,30][r%3],.7*s,.9*c));t.Solar.push(hsvToRgb([45,30,0][r%3],s,c));t.Aurora.push(hsvToRgb([120,180,270][r%3],.8*s,Math.min(c+.3,1)));t.Citrus.push(hsvToRgb([60,30,120][r%3],s,c));t.SandAndSea.push(hsvToRgb([30,210,180][r%3],.5*s,Math.min(c+.2,1)));t.Desert.push(hsvToRgb([30,30][r%2],.8*s,.9*c));t.Ice.push(hsvToRgb([200,210][r%2],.5*s,Math.min(c+.3,1)));t.Fire.push(hsvToRgb([0,30,60][r%3],s,c));t.JewelTone.push(hsvToRgb([120,0,240,270][r%4],1,1)),t.VintageCinema.push(hsvToRgb(l,.5*s,.6*c));t.Futuristic.push(hsvToRgb([120,0,240][r%3],1,Math.min(c+.5,1)));t.AutumnLeaves.push(hsvToRgb([0,30,60,30][r%4],s,Math.min(c+.3,1)));t.WinterWonderland.push(hsvToRgb([200,210][r%2],.5*s,Math.min(c+.3,1)));t.SpringBlossom.push(hsvToRgb([330,120,60][r%3],1,Math.min(c+.4,1)));t.SummerSky.push(hsvToRgb([210,240,270][r%3],1,c));t.Underwater.push(hsvToRgb([200,190,10][r%3],s,c));t.Coffee.push(hsvToRgb([30,15,0][r%3],.7*s,.8*c));t.Rustic.push(hsvToRgb([120,30,0][r%3],s,c));t.Festival.push(hsvToRgb([330,30,60][r%3],1,Math.min(c+.3,1)));t.Royal.push(hsvToRgb([270,45,240][r%3],1,c));t.Cyberpunk.push(hsvToRgb([330,240,180,120][r%4],1,Math.min(c+.5,1)));t.NaturesHarvest.push(hsvToRgb([60,120,30][r%3],s,c));t.Urban.push(hsvToRgb([0,0,0][r%2],.3*s,.6*c));t.GalaxyNight.push(hsvToRgb([240,270,0][r%3],s,Math.min(c+.3,1)));t.FloralPastel.push(hsvToRgb([330,270,120][r%3],.3,Math.min(c+.3,1)));t.OceanSunset.push(hsvToRgb([30,330,240][r%3],s,Math.min(c+.4,1))),t.Greyscale.push(hsvToRgb(l,0,c));const v=360/e.length*r;t.RainbowPastel.push(hsvToRgb(v,.2,Math.min(c+.4,1)));t.MutedEarth.push(hsvToRgb([120,30,60][r%3],.5*s,.7*c));t.ForestTwilight.push(hsvToRgb([120,240,30][r%3],s,c));t.Polar.push(hsvToRgb([0,210,240][r%3],.5*s,c));t.Peacock.push(hsvToRgb([120,200,270][r%3],s,Math.min(c+.2,1)));t.PixelArt.push(hsvToRgb([0,30,210,240][r%4],1,c>.5?1:.5));const b=360/e.length*r;t.GradientSpectrum.push(hsvToRgb(b,1,1));t.FlatUI.push(hsvToRgb([210,120,45,15][r%4],.6,.8));t.SciFiNeon.push(hsvToRgb([180,300,0][r%3],1,c>.7?1:.5*c)),t.MetalAndStone.push(hsvToRgb(l,.2,.6*c));t.Weather.push(hsvToRgb([210,220,0][r%3],.3,Math.min(c+.4,1)));t.ComicBook.push(hsvToRgb([0,60,240][r%3],1,1)),t.MinimalistNeutral.push(hsvToRgb(l,.3*s,Math.min(c+.2,1)));t.CandyCoated.push(hsvToRgb([330,0,60][r%3],.9,1));t.Gothic.push(hsvToRgb([270,0][r%2],s,.6*c));t.Garden.push(hsvToRgb([120,90,30][r%3],s,Math.min(c+.3,1))),t.FrostedGlass.push(hsvToRgb(l,.4*s,.8*c)),t.Painterly.push(hsvToRgb(l,.7*s,.9*c)),t.ShadowAndLight.push(hsvToRgb(l,0,c>.5?1:.4*c));t.NightSky.push(hsvToRgb([240,270,0][r%3],s,Math.min(c+.3,1)));t.CoralReef.push(hsvToRgb([15,180,160][r%3],s,Math.min(c+.5,1)));t.Marble.push(hsvToRgb([0,45,0][r%3],.2*s,Math.min(c+.5,1)));t.Smoke.push(hsvToRgb([210,220,270][r%3],.2*s,.8*c));t.StainedGlass.push(hsvToRgb([0,60,120,240][r%4],1,c));t.MinimalEarth.push(hsvToRgb([90,30,60][r%3],.5*s,.8*c))})),t}function rgbToHsv(e,t,a){e/=255,t/=255,a/=255;const o=Math.max(e,t,a),n=o-Math.min(e,t,a);let r,l,s=o;return r=0===n?0:o===e?(t-a)/n%6:o===t?(a-e)/n+2:(e-t)/n+4,r=Math.round(60*r),r<0&&(r+=360),l=0===o?0:n/o,[r,l,s]}function hsvToRgb(e,t,a){const o=a*t,n=o*(1-Math.abs(e/60%2-1)),r=a-o;let l,s,c;return[l,s,c]=e<60?[o,n,0]:e<120?[n,o,0]:e<180?[0,o,n]:e<240?[0,n,o]:e<300?[n,0,o]:[o,0,n],[Math.round(255*(l+r)),Math.round(255*(s+r)),Math.round(255*(c+r))]}function generatePaletteStructure(e){const t=document.createElement("div");t.className="colorSwatches",t.style.backgroundImage=generateVerticalGradientPalette(e),t.style.padding="10px",t.style.margin="5px",t.style.height="50px",document.body.appendChild(t)}function calculateEuclideanDistance(e,t){const a=e[0]-t[0],o=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(a*a+o*o+n*n)}function arePalettesSimilar(e,t,a=100){for(let o=0;o<e.length;o++){let n=!1;for(let r=0;r<t.length;r++){if(calculateEuclideanDistance(e[o],t[r])<=a){n=!0;break}}if(!n)return!1}return!0}function areColorsSimilar(e,t,a=10){return calculateEuclideanDistance(e,t)<=a}function waitForImageToLoad(e,t){var a=document.querySelector('img[alt*="'+e+'"]');a.complete&&0!==a.naturalHeight?t():a.onload=t}function removePalettesWithSimilarColors(e){const t=[],a=[];return Object.values(e).forEach(((o,n)=>{let r=!1;for(let e=0;e<o.length;e++){for(let t=e+1;t<o.length;t++)if(areColorsSimilar(o[e],o[t])){r=!0;break}if(r)break}if(r){const t=Object.keys(e)[n];a.push({[t]:o})}else t.push(o)})),console.log("uniquePalettes123",t),{uniqueColoredPalettes:t,removedColoredPalettes:a}}varientContainer&&waitForImageToLoad("base-image",(function(){console.log("Image is fully loaded. Running script...");let e=document.createElement("div");e.className="theme-product-varients-row";let t=document.createElement("div");t.id="cartContainer",t.className="theme-product-variant";let a=document.createElement("div");a.id="cartLabelContainer",a.className="theme-product-variant-label",a.innerHTML="Patterns in Cart";let o=document.createElement("div");o.id="cartPatternContainer",o.className="theme-product-variant-pattern",t.appendChild(a),t.appendChild(o),e.append(t),varientContainer.append(e),imgElement=document.querySelector('img[alt*="base-image"]'),function(){const e=window.fetch;window.fetch=function(...t){const a=e.apply(this,t),o="string"==typeof t[0]?t[0]:t[0]?.url;return o&&o.includes("/cart")?a.then((e=>(e.clone().json().then((e=>{document.dispatchEvent(new CustomEvent("cartUpdated",{detail:e}))})).catch((e=>{console.error("Failed to parse cart response:",e)})),e))):a}}(),function(){const e=window.XMLHttpRequest;window.XMLHttpRequest=function(){const t=new e;let a="";const o=t.open;return t.open=function(e,t){return a=e,o.apply(this,arguments)},t.addEventListener("readystatechange",(function(){if(4===t.readyState&&200===t.status){const e=t.responseURL;if(e.includes("/cart")&&("GET"===a||"POST"===a)){const e=JSON.parse(t.responseText);document.dispatchEvent(new CustomEvent("cartUpdated",{detail:e}))}if(e.includes("/cart")&&"DELETE"===a){const e=JSON.parse(t.responseText);document.dispatchEvent(new CustomEvent("cartDeleted",{detail:e}))}}})),t}}(),document.addEventListener("cartUpdated",(function(e){cartData=e.detail.payload,setTimeout((()=>{console.log("CART UPDATED"),updateFields()}),100)})),fetch("/storefront/api/v1/cart").then((e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()})),variantRows=document.querySelectorAll(".theme-product-varients-row");let n=0;patternSelection=[],variantRows.forEach((e=>{let t=e.querySelector(".theme-product-variant-label.theme-custom-field-label");if("source"===t?.textContent.replace("*","").trim()&&(source=e.querySelector("input"),e.style.display="none"),"target"===t?.textContent.replace("*","").trim()&&(target=e.querySelector("input"),e.style.display="none"),"Config"===t?.textContent.replace("*","").trim()&&(config=e.querySelector("span"),configObject=JSON.parse(config.textContent.trim()),e.style.display="none"),"Basic Color Pattern"===t?.textContent.replace("*","").trim()&&(basicColorConfig=e.querySelector("span"),basicColor=JSON.parse(basicColorConfig.textContent.trim()),e.style.display="none"),"Alternate Color Pattern"===t?.textContent.replace("*","").trim()&&(alternateColorConfig=e.querySelector("span"),alternateColor=JSON.parse(basicColorConfig.textContent.trim()),e.style.display="none"),t?.textContent.replace("*","").trim().toLowerCase().startsWith("selection")){selection[n]=e.querySelector("input");let t={};t.value=e.querySelector("input").value,t.field=e.querySelector("input").getAttribute("data-custom-field-id"),patternSelection[n]=JSON.stringify(t),n++,e.style.display="none"}}));const r=document.querySelector('[name="qty"]');if(r.disabled=!0,r){let e=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,"value");Object.defineProperty(r,"value",{get(){return e.get.call(this)},set(t){console.log("Value changed programmatically to:",t),e.set.call(this,t),updateTargetValue(t)},configurable:!0}),r.addEventListener("input",(()=>{console.log("Value changed by user to:",r.value)}))}productVariantId=extractIdFromUrl(window.location.href),quantityInput=document.querySelector('[title="quantity"]'),addLightboxEventListener();document.querySelector(".theme-custom-field-main-container").insertAdjacentHTML("afterbegin",'\n            <div class="customColorPickerPalette">\n                <div class="theme-product-variant-label theme-custom-field-label customColorPickerPalette" data-zs-customfield-label=""> \n                    Color\n                </div>\n                <div class=\'theme-product-varients-dynamic-selector\'>\n                    <div id="colorControls"></div>\n                    <div id="toColorSwatches"></div>\n                    <div class="custom-color-picker" style="display: none;" id="customColorPicker">\n                        <div class="sectionSelector" id="sectionSelector"></div>\n                        <label class="switch">\n                            <input type="checkbox" id="paletteToggle">\n                            <span class="slider"></span>\n                        </label>\n                        <div class="palette" id="palette" style="display: flex;"></div>\n                        <div class="palette2" id="palette2" style="display: none; flex; gap: 10px;">\n<canvas id="rgbColorPicker"></canvas>\n<div id="selectedColor" style=\'display:none\'></div>\n        <p id="colorCode" style=\'display:none\'></p>\n                        </div>\n                        <div id="color-display" style=\'display:none\'>Selected Color: None</div>\n                    </div>\n                </div>\n            </div>\n              <canvas id="imageCanvas" style="display: none;"></canvas>\n        '),paletteToggle=document.getElementById("paletteToggle"),palette1=document.getElementById("palette"),palette2=document.getElementById("palette2"),selectedColorDiv=document.getElementById("selectedColor"),colorCodeText=document.getElementById("colorCode"),colorControlsContainer=document.getElementById("colorControls"),toColorSwatchesContainer=document.getElementById("toColorSwatches"),customColorPicker=document.getElementById("customColorPicker"),paletteContainer=document.getElementById("palette");const l=document.querySelector(".theme-product-detail-image");designCanvas=document.createElement("canvas"),designCanvas.id="designCanvas",designCanvas.width=800,designCanvas.height=800,designCanvas.style.display="none",designCanvasCtx=designCanvas.getContext("2d"),imgElement.onload=()=>{designCanvasCtx.drawImage(imgElement,0,0)},imgElement.complete&&imgElement.onload();const s=new THREE.WebGLRenderer({alpha:!0,antialias:!0});s.domElement.id="renderedImage",l.appendChild(s.domElement),l.appendChild(designCanvas);const c=window.devicePixelRatio||1;s.setSize(l.clientWidth*c,l.clientWidth*c),s.domElement.style.width=l.clientWidth+"px",s.domElement.style.height=l.clientWidth+"px",s.setClearColor(16777215),renderedImage=document.querySelector("#renderedImage");const i=new THREE.OrthographicCamera(-5,5,5,-5,.1,1e3),d=new THREE.Scene;d.add(new THREE.AmbientLight(4210752));let u=new THREE.DirectionalLight(16777215,.5);u.position.set(50,5,150).normalize(),d.add(u),d.add(new THREE.AmbientLight(4210752));let h=new THREE.DirectionalLight(16777215,.5);h.position.set(0,0,0).normalize(),d.add(h);(new THREE.GLTFLoader).load(configObject.imageInfo.objectPath,(function(e){object=e.scene,d.add(object),object.scale.set(.1,.1,.1);const t=(new THREE.Box3).setFromObject(object).getCenter(new THREE.Vector3);object.position.set(t.x+1.25,t.y-.125,0),textureLoader=new THREE.TextureLoader,textures=configObject.imageInfo.textures.map((e=>{const t=textureLoader.load(e.texturePath);return t.generateMipmaps=!0,t.minFilter=THREE.LinearMipmapLinearFilter,{texture:t,objects:e.objects,transparent:e.transparent}}));textureLoader.load(document.querySelector("#designCanvas").toDataURL("image/png"),(function(e){e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,e.repeat.set(1,1),object.traverse((function(t){if(t.isMesh){t.name===configObject.imageInfo.backgroundPattern?t.material=new THREE.MeshStandardMaterial({map:e,transparent:!0,opacity:1,depthWrite:!1,emissive:new THREE.Color(16777215),emissiveIntensity:.3,color:new THREE.Color(16777215)}):configObject.imageInfo.appliedPattern.includes(t.name)&&(t.material=new THREE.MeshStandardMaterial({map:e,transparent:!0,opacity:1,depthWrite:!1}));const a=textures.find((e=>e.objects.includes(t.name)));a&&(t.material=new THREE.MeshStandardMaterial({map:a.texture,transparent:a.transparent})),t.material.needsUpdate=!0}}))}));i.position.set(t.x,t.y,10),i.lookAt(t);const a=function(){requestAnimationFrame(a),s.render(d,i)};a();const o=document.querySelector('img[alt*="base-image"]'),n=document.getElementById("imageCanvas"),r=n.getContext("2d");n.width=o.width,n.height=o.height,r.drawImage(o,0,0,n.width,n.height);const l=r.getImageData(0,0,n.width,n.height),c=[];for(let e=0;e<l.data.length;e+=4){const t=l.data[e],a=l.data[e+1],o=l.data[e+2];c.push([t,a,o])}const{averagedColors:u,clusterVariances:h}=simpleClusterColors(palette,c),m=calculateColorFrequency(l,u),g=(e,t,a)=>(e-t)/(a-t),p=Math.min(...m.map((e=>e.frequency))),v=Math.max(...m.map((e=>e.frequency))),b=Math.min(...h),C=Math.max(...h),y=u.filter(((e,t)=>{const a=g(m[t].frequency,p,v),o=g(h[t],b,C);return a>=.9||o<=.1}));maxPaletteCount=u.length,recommendedPaletteCount=y.length;const f=new ColorThief;for(let e=recommendedPaletteCount;e<=maxPaletteCount;e++){palette=f.getPalette(l,e);const t=generatePalettes(palette);generatePaletteStructure(palette);const a=Object.values(t),o=[],n=[];a.forEach(((e,t)=>{if(o.some((t=>arePalettesSimilar(t,e)))){const a=Object.keys(palette)[t];n.push({[a]:e})}else o.push(e)})),console.log("Unique Palettes:"),console.log(o);const{uniqueColoredPalettes:r,removedColoredPalettes:s}=removePalettesWithSimilarColors(o);console.log("Removed Palettes:"),console.log(r);for(let e=0;e<r.length;e++)generatePaletteStructure(r[e])}}),void 0,(function(e){console.error("An error occurred while loading the model:",e)}));const m=document.createElement("div");m.id="image-gallery",document.querySelector(".theme-product-detail-image-container").appendChild(m);const g=document.querySelector('img[alt*="base-image"]');m.append(g),g.addEventListener("click",(()=>{l.querySelectorAll("img").forEach((e=>e.remove())),renderedImage.style.display="block"})),configObject.commonImages.forEach((e=>{const t=document.createElement("img");t.src=e,t.alt="Common Image";const a=document.createElement("div");a.classList.add("image-wrapper"),a.appendChild(t),m.append(a),((e,t)=>{e.addEventListener("click",(()=>{document.querySelector("#renderedImage").style.display="none",l.querySelectorAll("img").forEach((e=>e.remove()));const e=document.createElement("img");e.src=t,e.alt="Selected Image",e.style.width=l.clientWidth+"px",e.style.height=l.clientWidth+"px",l.append(e)}))})(a,e)})),populatePalette(),generateControls(),generateCustomSelect(),paletteToggle.addEventListener("change",(()=>{const e=paletteToggle.checked;palette1.style.display=e?"none":"flex",palette2.style.display=e?"flex":"none"})),createColorPicker(),"Mobile"!==detectDevice()&&"Tablet"!==detectDevice()||alterPalette()})),document.addEventListener("DOMContentLoaded",loadPage);let startX=0,currentIndex=0;function alterPalette(){document.querySelector("#image-gallery").style.display="none";const e=document.querySelector(".theme-product-detail-image");e.addEventListener("touchstart",handleTouchStart,!1),e.addEventListener("touchmove",handleTouchMove,!1),e.addEventListener("touchend",handleTouchEnd,!1),document.querySelector(".theme-rating-review-container").prepend(document.querySelector(".customColorPickerPalette"))}function handleTouchStart(e){isTouching=!0;const t=e.touches[0];startX=t.clientX}function handleTouchMove(e){if(!isTouching)return;e.touches[0].clientX}function handleTouchEnd(e){if(!isTouching)return;const t=e.changedTouches[0].clientX;startX>t+50?triggerSlide("left"):startX<t-50&&triggerSlide("right"),isTouching=!1}function triggerSlide(e){document.querySelectorAll(".slide").length;"left"===e?moveSelection(1):"right"===e&&moveSelection(-1)}function moveSelection(e){console.log("totalImages1");const t=document.querySelector("#image-gallery").querySelectorAll("img"),a=t.length;console.log("totalImages",a);let o=currentIndex+e;o<0||o>=a||(t[currentIndex].classList.remove("selected"),currentIndex=o,t[currentIndex].click(),t[currentIndex].classList.add("selected"))}